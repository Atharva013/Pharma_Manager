<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pharmacy Inventory Management</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #4a6fa5;
      --primary-light: #e8f0fe;
      --danger-color: #e74c3c;
      --danger-light: #fde8e8;
      --warning-color: #f39c12;
      --warning-light: #fff4e6;
      --success-color: #2ecc71;
      --success-light: #e8f8f0;
      --info-color: #3498db;
      --light-gray: #f8f9fa;
      --medium-gray: #e9ecef;
      --dark-gray: #343a40;
      --text-color: #495057;
      --border-radius: 8px;
      --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }
    
    body {
      background-color: #f5f7fa;
      color: var(--text-color);
      line-height: 1.6;
      padding: 0;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 30px;
    }
    
    h2, h3 {
      color: var(--dark-gray);
      margin-bottom: 20px;
      font-weight: 600;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--medium-gray);
    }
    
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: var(--border-radius);
      cursor: pointer;
      font-weight: 500;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
    }
    
    .btn-primary {
      background-color: var(--primary-color);
      color: white;
    }
    
    .btn-primary:hover {
      background-color: #3a5a8a;
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(74, 111, 165, 0.3);
    }
    
    .btn-danger {
      background-color: var(--danger-color);
      color: white;
    }
    
    .btn-danger:hover {
      background-color: #c0392b;
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(231, 76, 60, 0.3);
    }
    
    .btn-warning {
      background-color: var(--warning-color);
      color: white;
    }
    
    .btn-warning:hover {
      background-color: #d35400;
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(243, 156, 18, 0.3);
    }
    
    .btn-success {
      background-color: var(--success-color);
      color: white;
    }
    
    .btn-success:hover {
      background-color: #27ae60;
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(46, 204, 113, 0.3);
    }
    
    .btn-outline {
      background-color: transparent;
      border: 1px solid var(--medium-gray);
      color: var(--text-color);
    }
    
    .btn-outline:hover {
      background-color: var(--light-gray);
      transform: translateY(-1px);
    }
    
    .btn i {
      font-size: 14px;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--dark-gray);
      font-size: 14px;
    }
    
    input, select {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid var(--medium-gray);
      border-radius: var(--border-radius);
      font-size: 15px;
      transition: var(--transition);
      background-color: white;
    }
    
    input:focus, select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.2);
    }
    
    .form-row {
      display: flex;
      gap: 20px;
      margin-bottom: 15px;
    }
    
    .form-row .form-group {
      flex: 1;
    }
    
    .card {
      background-color: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 25px;
      margin-bottom: 25px;
      transition: var(--transition);
      border: 1px solid var(--medium-gray);
    }
    
    .card:hover {
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
    }
    
    .card-title {
      font-size: 18px;
      margin-bottom: 20px;
      color: var(--dark-gray);
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: 600;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }
    
    th, td {
      padding: 15px;
      text-align: left;
      border-bottom: 1px solid var(--medium-gray);
      vertical-align: middle;
    }
    
    th {
      background-color: var(--light-gray);
      font-weight: 600;
      cursor: pointer;
      user-select: none;
      color: var(--dark-gray);
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    th:hover {
      background-color: #e2e6ea;
    }
    
    tr {
      transition: var(--transition);
    }
    
    tr:hover {
      background-color: var(--light-gray);
    }
    
    .low-stock {
      background-color: var(--danger-light);
    }
    
    .low-stock td:first-child {
      border-left: 4px solid var(--danger-color);
    }
    
    .expiring-soon {
      background-color: var(--warning-light);
    }
    
    .expiring-soon td:first-child {
      border-left: 4px solid var(--warning-color);
    }
    
    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      margin-left: 8px;
    }
    
    .badge-danger {
      background-color: var(--danger-color);
      color: white;
    }
    
    .badge-warning {
      background-color: var(--warning-color);
      color: white;
    }
    
    .badge-success {
      background-color: var(--success-color);
      color: white;
    }
    
    .search-filter {
      display: flex;
      gap: 15px;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }
    
    .search-filter input, .search-filter select {
      flex: 1;
      min-width: 200px;
      max-width: 300px;
      padding: 10px 15px;
      font-size: 14px;
    }
    
    .pagination {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 25px;
    }
    
    .pagination button {
      padding: 8px 14px;
      border: 1px solid var(--medium-gray);
      background-color: white;
      cursor: pointer;
      border-radius: 4px;
      transition: var(--transition);
      font-size: 14px;
    }
    
    .pagination button.active {
      background-color: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }
    
    .pagination button:hover:not(.active) {
      background-color: var(--light-gray);
    }
    
    .actions {
      display: flex;
      gap: 8px;
    }
    
    .actions button {
      width: 32px;
      height: 32px;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: var(--light-gray);
      color: var(--text-color);
    }
    
    .actions button:hover {
      transform: scale(1.1);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }
    
    .edit-btn {
      background-color: var(--primary-light);
      color: var(--primary-color);
    }
    
    .edit-btn:hover {
      background-color: var(--primary-color);
      color: white;
    }
    
    .delete-btn {
      background-color: var(--danger-light);
      color: var(--danger-color);
    }
    
    .delete-btn:hover {
      background-color: var(--danger-color);
      color: white;
    }
    
    .reorder-btn {
      background-color: var(--success-light);
      color: var(--success-color);
    }
    
    .reorder-btn:hover {
      background-color: var(--success-color);
      color: white;
    }
    
    .toast {
      position: fixed;
      bottom: 30px;
      right: 30px;
      padding: 15px 25px;
      border-radius: var(--border-radius);
      color: white;
      z-index: 1000;
      animation: slideIn 0.5s, fadeOut 0.5s 2.5s;
      box-shadow: var(--box-shadow);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .toast i {
      font-size: 18px;
    }
    
    .toast-success {
      background-color: var(--success-color);
    }
    
    .toast-error {
      background-color: var(--danger-color);
    }
    
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }
    
    /* Status indicators */
    .status-indicator {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 8px;
    }
    
    .status-active {
      background-color: var(--success-color);
    }
    
    .status-warning {
      background-color: var(--warning-color);
    }
    
    .status-danger {
      background-color: var(--danger-color);
    }
    
    /* Floating action button */
    .fab {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background-color: var(--primary-color);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(74, 111, 165, 0.3);
      transition: var(--transition);
      z-index: 999;
      font-size: 24px;
    }
    
    .fab:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 6px 16px rgba(74, 111, 165, 0.4);
    }
    
    /* Loading spinner */
    .spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Responsive adjustments */
    @media (max-width: 992px) {
      .container {
        padding: 20px;
      }
      
      .form-row {
        flex-direction: column;
        gap: 0;
      }
      
      .search-filter input, .search-filter select {
        max-width: 100%;
      }
    }
    
    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
      }
      
      .actions {
        flex-direction: column;
      }
      
      .actions button {
        width: 28px;
        height: 28px;
      }
      
      th, td {
        padding: 12px 8px;
      }
    }
    
    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: var(--light-gray);
    }
    
    ::-webkit-scrollbar-thumb {
      background: var(--primary-color);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: #3a5a8a;
    }
    
    /* Tooltip */
    [data-tooltip] {
      position: relative;
    }
    
    [data-tooltip]:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background-color: var(--dark-gray);
      color: white;
      padding: 5px 10px;
      border-radius: 4px;
      font-size: 12px;
      white-space: nowrap;
      z-index: 100;
      margin-bottom: 5px;
    }
    
    /* Animated transitions */
    .fade-in {
      animation: fadeIn 0.5s ease-in-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Highlight effect for table rows */
    @keyframes highlight {
      0% { background-color: var(--primary-light); }
      100% { background-color: white; }
    }
    
    .highlight {
      animation: highlight 1.5s;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h2><i class="fas fa-pills" style="color: var(--primary-color); margin-right: 10px;"></i> Pharmacy Inventory Dashboard</h2>
      <div style="display: flex; gap: 15px;">
        <button class="btn btn-primary" id="addMedicineBtn">
          <i class="fas fa-plus"></i> Add Medicine
        </button>
        <button class="btn btn-success" id="importBtn">
          <i class="fas fa-file-import"></i> Import
        </button>
      </div>
    </div>

    <!-- Stats Cards -->
    <div class="search-filter" style="margin-bottom: 15px;">
      <div class="card" style="flex: 1; text-align: center; padding: 15px;">
        <h3 style="color: var(--primary-color); margin-bottom: 5px;">Total Items</h3>
        <p style="font-size: 24px; font-weight: 600;">{{ inventory|length }}</p>
      </div>
      <div class="card" style="flex: 1; text-align: center; padding: 15px;">
        <h3 style="color: var(--warning-color); margin-bottom: 5px;">Low Stock</h3>
        <p style="font-size: 24px; font-weight: 600;">{{ inventory|selectattr('quantity', 'lt', 10)|list|length }}</p>
      </div>
      <div class="card" style="flex: 1; text-align: center; padding: 15px;">
        <h3 style="color: var(--danger-color); margin-bottom: 5px;">Expiring Soon</h3>
        <p style="font-size: 24px; font-weight: 600;">0</p>
      </div>
    </div>

    <!-- Add Medicine Form (Initially hidden) -->
    <div class="card fade-in" id="addMedicineForm" style="display: none;">
      <div class="card-title">
        <span><i class="fas fa-pills" style="margin-right: 10px;"></i> Add New Medicine</span>
        <button class="btn btn-danger" id="closeFormBtn" style="padding: 8px 12px;"><i class="fas fa-times"></i></button>
      </div>
      <form action="/add_inventory" method="POST">
        <div class="form-row">
          <div class="form-group">
            <label for="item_name"><i class="fas fa-tag" style="margin-right: 5px;"></i> Medicine Name</label>
            <input type="text" id="item_name" name="item_name" placeholder="e.g., Paracetamol 500mg" required>
          </div>
          <div class="form-group">
            <label for="batch_number"><i class="fas fa-barcode" style="margin-right: 5px;"></i> Batch Number</label>
            <input type="text" id="batch_number" name="batch_number" placeholder="e.g., PC2023A1" required>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="expiry_date"><i class="fas fa-calendar-times" style="margin-right: 5px;"></i> Expiry Date</label>
            <input type="date" id="expiry_date" name="expiry_date" required>
          </div>
          <div class="form-group">
            <label for="quantity"><i class="fas fa-cubes" style="margin-right: 5px;"></i> Quantity</label>
            <input type="number" id="quantity" name="quantity" placeholder="e.g., 100" min="1" required>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="price"><i class="fas fa-rupee-sign" style="margin-right: 5px;"></i> Price per Unit (₹)</label>
            <input type="number" id="price" name="price" placeholder="e.g., 5.50" step="0.01" min="0" required>
          </div>
          <div class="form-group">
            <label for="supplier_id"><i class="fas fa-truck" style="margin-right: 5px;"></i> Supplier</label>
            <select id="supplier_id" name="supplier_id" required>
              <option value="" disabled selected>Select Supplier</option>
              {% for supplier in suppliers %}
                <option value="{{ supplier.supplier_id }}">{{ supplier.supplier_name }} ({{ supplier.supplier_id }})</option>
              {% endfor %}
            </select>
          </div>
        </div>
        
        <div style="display: flex; justify-content: flex-end; gap: 10px;">
          <button type="reset" class="btn btn-outline">
            <i class="fas fa-undo"></i> Reset
          </button>
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-save"></i> Save Medicine
          </button>
        </div>
      </form>
    </div>

    <!-- Bulk Import Form (Initially hidden) -->
    <div class="card fade-in" id="importForm" style="display: none;">
      <div class="card-title">
        <span><i class="fas fa-file-import" style="margin-right: 10px;"></i> Bulk Import Medicines</span>
        <button class="btn btn-danger" id="closeImportBtn" style="padding: 8px 12px;"><i class="fas fa-times"></i></button>
      </div>
      <form action="/import_inventory" method="POST" enctype="multipart/form-data">
        <div class="form-group">
          <label for="csv_file"><i class="fas fa-file-csv" style="margin-right: 5px;"></i> Select CSV File</label>
          <div style="border: 2px dashed var(--medium-gray); border-radius: var(--border-radius); padding: 30px; text-align: center; margin-bottom: 15px;">
            <i class="fas fa-cloud-upload-alt" style="font-size: 36px; color: var(--primary-color); margin-bottom: 10px;"></i>
            <p style="margin-bottom: 15px;">Drag & drop your CSV file here or click to browse</p>
            <input type="file" id="csv_file" name="csv_file" accept=".csv" required style="display: none;">
            <button type="button" class="btn btn-outline" onclick="document.getElementById('csv_file').click()">
              <i class="fas fa-folder-open"></i> Browse Files
            </button>
          </div>
          <small style="color: var(--text-color);"><i class="fas fa-info-circle" style="margin-right: 5px;"></i> Download our <a href="/sample_inventory.csv" download style="color: var(--primary-color);">sample CSV template</a> for reference</small>
        </div>
        <div style="display: flex; justify-content: flex-end; gap: 10px;">
          <button type="button" class="btn btn-outline" id="cancelImportBtn">
            <i class="fas fa-times"></i> Cancel
          </button>
          <button type="submit" class="btn btn-success">
            <i class="fas fa-upload"></i> Upload and Import
          </button>
        </div>
      </form>
    </div>

    <!-- Search and Filter Section -->
    <div class="card">
      <div class="card-title">
        <span><i class="fas fa-search" style="margin-right: 10px;"></i> Search & Filter</span>
      </div>
      <div class="search-filter">
        <div class="form-group" style="flex: 2;">
          <input type="text" id="searchInput" placeholder="Search medicines by name, batch or ID...">
        </div>
        <div class="form-group">
          <select id="supplierFilter">
            <option value="">All Suppliers</option>
            {% for supplier in suppliers %}
              <option value="{{ supplier.supplier_id }}">{{ supplier.supplier_name }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="form-group">
          <select id="stockFilter">
            <option value="">All Stock Levels</option>
            <option value="low">Low Stock (<10)</option>
            <option value="normal">Normal Stock</option>
          </select>
        </div>
        <div class="form-group">
          <select id="expiryFilter">
            <option value="">All Expiry Dates</option>
            <option value="soon">Expiring Soon (within 30 days)</option>
            <option value="expired">Expired</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Inventory List -->
    <div class="card">
      <div class="card-title">
        <span><i class="fas fa-clipboard-list" style="margin-right: 10px;"></i> Current Inventory</span>
        <div>
          <small style="color: var(--text-color);">Showing <span id="itemCount">{{ inventory|length }}</span> items</small>
        </div>
      </div>
      
      <div style="overflow-x: auto;">
        <table id="inventoryTable">
          <thead>
            <tr>
              <th data-sort="item_id">ID <i class="fas fa-sort"></i></th>
              <th data-sort="item_name">Medicine Name <i class="fas fa-sort"></i></th>
              <th data-sort="batch_number">Batch No. <i class="fas fa-sort"></i></th>
              <th data-sort="expiry_date">Expiry Date <i class="fas fa-sort"></i></th>
              <th data-sort="quantity">Quantity <i class="fas fa-sort"></i></th>
              <th data-sort="price">Price (₹) <i class="fas fa-sort"></i></th>
              <th data-sort="supplier_id">Supplier <i class="fas fa-sort"></i></th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for item in inventory %}
            {% set isLowStock = item.quantity < 10 %}
            {% set isExpiringSoon = false %} <!-- You would calculate this based on expiry_date -->
            <tr class="{% if isLowStock %}low-stock{% endif %} {% if isExpiringSoon %}expiring-soon{% endif %}">
              <td>#{{ item.item_id }}</td>
              <td>
                <div style="display: flex; align-items: center;">
                  <span class="status-indicator {% if isLowStock %}status-danger{% else %}status-active{% endif %}"></span>
                  {{ item.item_name }}
                </div>
                {% if isLowStock %}
                  <span class="badge badge-danger">Low Stock</span>
                {% endif %}
                {% if isExpiringSoon %}
                  <span class="badge badge-warning">Expiring Soon</span>
                {% endif %}
              </td>
              <td>{{ item.batch_number }}</td>
              <td>{{ item.expiry_date }}</td>
              <td contenteditable="true" data-field="quantity" data-id="{{ item.item_id }}">
                {{ item.quantity }}
              </td>
              <td contenteditable="true" data-field="price" data-id="{{ item.item_id }}">
                ₹{{ "%.2f"|format(item.price) }}
              </td>
              <td>
                {% for supplier in suppliers %}
                  {% if supplier.supplier_id == item.supplier_id %}
                    {{ supplier.supplier_name }}
                  {% endif %}
                {% endfor %}
              </td>
              <td class="actions">
                <button class="edit-btn" title="Edit" data-id="{{ item.item_id }}" data-tooltip="Edit">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="delete-btn" title="Delete" data-id="{{ item.item_id }}" data-tooltip="Delete">
                  <i class="fas fa-trash"></i>
                </button>
                {% if isLowStock %}
                <button class="reorder-btn" title="Reorder" data-id="{{ item.item_id }}" data-tooltip="Reorder">
                  <i class="fas fa-shopping-cart"></i>
                </button>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      
      <!-- Pagination -->
      <div class="pagination">
        <button><i class="fas fa-angle-double-left"></i></button>
        <button class="active">1</button>
        <button>2</button>
        <button>3</button>
        <button><i class="fas fa-angle-double-right"></i></button>
      </div>
    </div>

    <!-- Floating Action Button -->
    <div class="fab" id="mobileAddBtn" style="display: none;">
      <i class="fas fa-plus"></i>
    </div>
  </div>

  <script>
    // Toggle Add Medicine Form
    document.getElementById('addMedicineBtn').addEventListener('click', function() {
      document.getElementById('addMedicineForm').style.display = 'block';
      document.getElementById('importForm').style.display = 'none';
      document.getElementById('addMedicineForm').scrollIntoView({ behavior: 'smooth' });
    });
    
    document.getElementById('mobileAddBtn').addEventListener('click', function() {
      document.getElementById('addMedicineForm').style.display = 'block';
      document.getElementById('importForm').style.display = 'none';
      document.getElementById('addMedicineForm').scrollIntoView({ behavior: 'smooth' });
    });
    
    document.getElementById('closeFormBtn').addEventListener('click', function(e) {
      e.preventDefault();
      document.getElementById('addMedicineForm').style.display = 'none';
    });
    
    // Toggle Import Form
    document.getElementById('importBtn').addEventListener('click', function() {
      document.getElementById('importForm').style.display = 'block';
      document.getElementById('addMedicineForm').style.display = 'none';
      document.getElementById('importForm').scrollIntoView({ behavior: 'smooth' });
    });
    
    document.getElementById('closeImportBtn').addEventListener('click', function(e) {
      e.preventDefault();
      document.getElementById('importForm').style.display = 'none';
    });
    
    document.getElementById('cancelImportBtn').addEventListener('click', function(e) {
      e.preventDefault();
      document.getElementById('importForm').style.display = 'none';
    });
    
    // File upload UI enhancement
    const fileInput = document.getElementById('csv_file');
    const fileUploadArea = fileInput.previousElementSibling;
    
    fileInput.addEventListener('change', function() {
      if (this.files.length > 0) {
        fileUploadArea.querySelector('p').textContent = this.files[0].name;
      }
    });
    
    // Drag and drop functionality
   // Drag and drop functionality
fileUploadArea.addEventListener('dragover', (e) => {
    e.preventDefault();
    fileUploadArea.style.borderColor = 'var(--primary-color)';
    fileUploadArea.style.backgroundColor = 'rgba(74, 111, 165, 0.1)';
});
    
    fileUploadArea.addEventListener('dragleave', () => {
    fileUploadArea.style.borderColor = 'var(--medium-gray)';
    fileUploadArea.style.backgroundColor = 'transparent';
});

fileUploadArea.addEventListener('drop', (e) => {
    e.preventDefault();
    fileUploadArea.style.borderColor = 'var(--medium-gray)';
    fileUploadArea.style.backgroundColor = 'transparent';

    if (e.dataTransfer.files.length) {
        fileInput.files = e.dataTransfer.files;
        fileUploadArea.querySelector('p').textContent = e.dataTransfer.files[0].name;
    }
});
    
    // Table Sorting with animation
    document.querySelectorAll('th[data-sort]').forEach(header => {
      header.addEventListener('click', function() {
        const sortField = this.getAttribute('data-sort');
        const isAscending = this.classList.contains('asc');
        
        // Reset all headers
        document.querySelectorAll('th[data-sort]').forEach(h => {
          h.classList.remove('asc', 'desc');
          h.querySelector('i').className = 'fas fa-sort';
        });
        
        // Set new sort direction
        this.classList.toggle('asc', !isAscending);
        this.classList.toggle('desc', isAscending);
        
        // Update sort icon
        const icon = this.querySelector('i');
        icon.className = isAscending ? 'fas fa-sort-down' : 'fas fa-sort-up';
        
        // Sort the table (in a real app, you would send this to the server)
        console.log(`Sorting by ${sortField} in ${isAscending ? 'descending' : 'ascending'} order`);
        
        // Add animation to table rows
        const table = document.getElementById('inventoryTable');
        table.classList.add('highlight');
        setTimeout(() => {
          table.classList.remove('highlight');
        }, 1500);
      });
    });
    
    // Search Functionality with debounce
    let searchTimeout;
    document.getElementById('searchInput').addEventListener('input', function() {
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(() => {
        const searchTerm = this.value.toLowerCase();
        const rows = document.querySelectorAll('#inventoryTable tbody tr');
        
        rows.forEach(row => {
          const text = row.textContent.toLowerCase();
          if (text.includes(searchTerm)) {
            row.style.display = '';
            row.classList.add('highlight');
            setTimeout(() => row.classList.remove('highlight'), 1000);
          } else {
            row.style.display = 'none';
          }
        });
        updateItemCount();
      }, 300);
    });
    
    // Filter Functionality
    document.getElementById('supplierFilter').addEventListener('change', applyFilters);
    document.getElementById('stockFilter').addEventListener('change', applyFilters);
    document.getElementById('expiryFilter').addEventListener('change', applyFilters);
    
    function applyFilters() {
      const supplierFilter = document.getElementById('supplierFilter').value;
      const stockFilter = document.getElementById('stockFilter').value;
      const expiryFilter = document.getElementById('expiryFilter').value;
      
      const rows = document.querySelectorAll('#inventoryTable tbody tr');
      
      rows.forEach(row => {
        const supplierMatch = supplierFilter === '' || row.cells[6].textContent.includes(supplierFilter);
        const stockMatch = stockFilter === '' || 
                         (stockFilter === 'low' && row.classList.contains('low-stock')) ||
                         (stockFilter === 'normal' && !row.classList.contains('low-stock'));
        const expiryMatch = expiryFilter === ''; // You would add actual expiry date logic
        
        if (supplierMatch && stockMatch && expiryMatch) {
          row.style.display = '';
          row.classList.add('highlight');
          setTimeout(() => row.classList.remove('highlight'), 1000);
        } else {
          row.style.display = 'none';
        }
      });
      updateItemCount();
    }
    
    // Inline Editing with better UX
    document.querySelectorAll('[contenteditable="true"]').forEach(cell => {
      cell.addEventListener('focus', function() {
        this.style.backgroundColor = 'var(--primary-light)';
        this.style.border = '1px solid var(--primary-color)';
        this.style.borderRadius = '4px';
        this.style.padding = '8px';
        this.originalText = this.textContent;
      });
      
      cell.addEventListener('blur', function() {
        this.style.backgroundColor = '';
        this.style.border = '';
        this.style.borderRadius = '';
        this.style.padding = '';
        
        const field = this.getAttribute('data-field');
        const id = this.getAttribute('data-id');
        const newValue = this.textContent.trim();
        
        if (newValue !== this.originalText) {
          // In a real app, you would send this to the server
          console.log(`Updating item ${id}, field ${field} to ${newValue}`);
          
          // Show a temporary confirmation
          const originalText = this.textContent;
          this.innerHTML = '<span style="color: var(--success-color);"><i class="fas fa-check-circle"></i> Saved</span>';
          setTimeout(() => {
            this.textContent = originalText;
          }, 1500);
        }
      });
      
      cell.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
          e.preventDefault();
          this.blur();
        }
      });
    });
    
    // Action Buttons with confirmation
    document.querySelectorAll('.edit-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        const id = this.getAttribute('data-id');
        console.log(`Edit item ${id}`);
        // In a real app, you would open an edit modal or similar
      });
    });
    
    // Delete Functionality with AJAX and better UX
    document.querySelectorAll('.delete-btn').forEach(btn => {
      btn.addEventListener('click', async function() {
        const id = this.getAttribute('data-id');
        const row = this.closest('tr');
        const medicineName = row.cells[1].textContent.trim();
        
        // Custom confirmation dialog
        const confirmed = await showConfirmDialog(
          `Delete "${medicineName}"?`,
          'Are you sure you want to delete this medicine? This action cannot be undone.',
          'Delete',
          'Cancel'
        );
        
        if (confirmed) {
          this.innerHTML = '<div class="spinner"></div>';
          this.disabled = true;
          
          try {
            // Simulate API call
            await new Promise(resolve => setTimeout(resolve, 1000));
            // In a real app, you would use:
            /*
            const response = await fetch(`/inventory/${id}`, {
              method: 'DELETE',
              headers: {
                'Content-Type': 'application/json'
              }
            });
            
            if (!response.ok) {
              throw new Error('Delete failed');
            }
            */
            
            row.style.animation = 'fadeOut 0.5s';
            setTimeout(() => {
              row.remove();
              showToast('Medicine deleted successfully', 'success');
              updateItemCount();
            }, 500);
          } catch (error) {
            console.error('Error:', error);
            this.innerHTML = '<i class="fas fa-trash"></i>';
            this.disabled = false;
            showToast('Failed to delete medicine', 'error');
          }
        }
      });
    });
    
    document.querySelectorAll('.reorder-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        const id = this.getAttribute('data-id');
        console.log(`Reorder item ${id}`);
        // In a real app, you would open a reorder form or similar
      });
    });

    // Custom confirmation dialog
    async function showConfirmDialog(title, message, confirmText, cancelText) {
      return new Promise((resolve) => {
        const dialog = document.createElement('div');
        dialog.style.position = 'fixed';
        dialog.style.top = '0';
        dialog.style.left = '0';
        dialog.style.width = '100%';
        dialog.style.height = '100%';
        dialog.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
        dialog.style.display = 'flex';
        dialog.style.justifyContent = 'center';
        dialog.style.alignItems = 'center';
        dialog.style.zIndex = '2000';
        
        const content = document.createElement('div');
        content.style.backgroundColor = 'white';
        content.style.padding = '25px';
        content.style.borderRadius = 'var(--border-radius)';
        content.style.boxShadow = 'var(--box-shadow)';
        content.style.maxWidth = '400px';
        content.style.width = '90%';
        
        content.innerHTML = `
          <h3 style="margin-bottom: 15px; color: var(--dark-gray);">${title}</h3>
          <p style="margin-bottom: 25px; color: var(--text-color);">${message}</p>
          <div style="display: flex; justify-content: flex-end; gap: 10px;">
            <button id="confirmCancel" class="btn btn-outline">${cancelText}</button>
            <button id="confirmOk" class="btn btn-danger">${confirmText}</button>
          </div>
        `;
        
        dialog.appendChild(content);
        document.body.appendChild(dialog);
        
        document.getElementById('confirmOk').addEventListener('click', () => {
          document.body.removeChild(dialog);
          resolve(true);
        });
        
        document.getElementById('confirmCancel').addEventListener('click', () => {
          document.body.removeChild(dialog);
          resolve(false);
        });
      });
    }

    // Helper function to show toast notifications
    function showToast(message, type = 'success') {
      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      toast.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
        ${message}
      `;
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.remove();
      }, 3000);
    }

    // Helper function to update item count display
    function updateItemCount() {
      const visibleRows = document.querySelectorAll('#inventoryTable tbody tr:not([style*="display: none"])');
      document.getElementById('itemCount').textContent = visibleRows.length;
    }
    
    // Show/hide floating action button based on screen size
    function checkScreenSize() {
      if (window.innerWidth < 768) {
        document.getElementById('mobileAddBtn').style.display = 'flex';
      } else {
        document.getElementById('mobileAddBtn').style.display = 'none';
      }
    }
    
    window.addEventListener('resize', checkScreenSize);
    checkScreenSize();
    
    // Add animation to table rows on load
    document.addEventListener('DOMContentLoaded', () => {
      const rows = document.querySelectorAll('#inventoryTable tbody tr');
      rows.forEach((row, index) => {
        setTimeout(() => {
          row.classList.add('highlight');
          setTimeout(() => row.classList.remove('highlight'), 1000);
        }, index * 50);
      });
    });
  </script>
</body>
</html>